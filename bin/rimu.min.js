var Rimu;(function(Rimu){function render(source,options){if(typeof options==="undefined"){options={}}Rimu.Options.update(options);return renderSource(source)}Rimu.render=render;function renderSource(source){var reader=new Rimu.Reader(source);var writer=new Rimu.Writer;while(!reader.eof()){reader.skipBlankLines();if(reader.eof())break;if(Rimu.LineBlocks.render(reader,writer))continue;if(Rimu.Lists.render(reader,writer))continue;if(Rimu.DelimitedBlocks.render(reader,writer))continue;console.error("no matching delimited block found")}return writer.toString()}Rimu.renderSource=renderSource})(Rimu||(Rimu={}));if(typeof exports!=="undefined"){exports.render=Rimu.render}this.Rimu=Rimu;var Rimu;(function(Rimu){function trimLeft(s){return s.replace(/^\s+/g,"")}Rimu.trimLeft=trimLeft;function trimRight(s){return s.replace(/\s+$/g,"")}Rimu.trimRight=trimRight;function trim(s){return s.replace(/^\s+|\s+$/g,"")}Rimu.trim=trim;function escapeRegExp(s){return s.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}Rimu.escapeRegExp=escapeRegExp;function replaceSpecialChars(s){return s.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}Rimu.replaceSpecialChars=replaceSpecialChars;function replaceMatch(match,replacement,expansionOptions){return replacement.replace(/\$\d/g,function(){var i=parseInt(arguments[0][1]);var text=match[i];return replaceInline(text,expansionOptions)})}Rimu.replaceMatch=replaceMatch;function replaceInline(text,expansionOptions){if(expansionOptions.macros){text=Rimu.Macros.render(text);text=text===null?"":text}if(expansionOptions.spans){return Rimu.Spans.render(text)}else if(expansionOptions.specials){return replaceSpecialChars(text)}else{return text}}Rimu.replaceInline=replaceInline;function injectHtmlAttributes(tag){if(!tag){return tag}if(Rimu.LineBlocks.classAttributes){if(/class="\S.*"/.test(tag)){tag=tag.replace(/class="(\S.*?)"/,'class="'+Rimu.LineBlocks.classAttributes+' $1"')}else{Rimu.LineBlocks.htmlAttributes=trim('class="'+Rimu.LineBlocks.classAttributes+'" '+Rimu.LineBlocks.htmlAttributes)}}if(Rimu.LineBlocks.htmlAttributes){var match=tag.match(/^<([a-zA-Z]+|h[1-6])(?=[ >])/);if(match){var before=tag.slice(0,match[0].length);var after=tag.slice(match[0].length);tag=before+" "+Rimu.LineBlocks.htmlAttributes+after}}Rimu.LineBlocks.classAttributes="";Rimu.LineBlocks.htmlAttributes="";return tag}Rimu.injectHtmlAttributes=injectHtmlAttributes})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(Options){Options.safeMode;Options.htmlReplacement;function update(options){Options.safeMode="safeMode"in options?options.safeMode:0;Options.htmlReplacement="htmlReplacement"in options?options.htmlReplacement:"<mark>replaced HTML<mark>"}Options.update=update;function safeModeFilter(text){switch(Options.safeMode){case 0:return text;case 1:return"";case 2:return Options.htmlReplacement;case 3:return Rimu.replaceSpecialChars(text);default:console.error("illegal safeMode value")}}Options.safeModeFilter=safeModeFilter;update({})})(Rimu.Options||(Rimu.Options={}));var Options=Rimu.Options})(Rimu||(Rimu={}));var Rimu;(function(Rimu){var Reader=function(){function Reader(text){var lines=text.split(/\r\n|\r|\n/g);for(var i in lines){lines[i]=lines[i].replace(/\s+$/,"")}this.lines=lines;this.pos=0}Reader.prototype.cursor=function(value){if(typeof value==="undefined"){value=null}if(this.eof())return null;if(value!==null){this.lines[this.pos]=value}return this.lines[this.pos]};Reader.prototype.eof=function(){return this.pos>=this.lines.length};Reader.prototype.next=function(){if(this.eof())return null;this.pos++;if(this.eof())return null;return this.lines[this.pos]};Reader.prototype.readTo=function(find){var result=[];var match;while(!this.eof()){match=this.cursor().match(find);if(match){if(match.length>1){result.push(match[1])}this.next();break}result.push(this.cursor());this.next()}if(match||find.toString()==="/^$/"&&this.eof()){return result}else{return null}};Reader.prototype.skipBlankLines=function(){while(this.cursor()===""){this.next()}};return Reader}();Rimu.Reader=Reader;var Writer=function(){function Writer(){this.buffer=[]}Writer.prototype.write=function(s){this.buffer.push(s)};Writer.prototype.toString=function(){return this.buffer.join("")};return Writer}();Rimu.Writer=Writer;if(typeof exports!=="undefined"){exports.Reader=Rimu.Reader;exports.Writer=Rimu.Writer}})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(Macros){var MATCH_MACRO=/\{([\w\-]+)([!=|?](?:|[\s\S]*?[^\\]))?\}/;var MATCH_MACROS=RegExp("\\\\?"+MATCH_MACRO.source,"g");Macros.MACRO_LINE=RegExp("^"+MATCH_MACRO.source+".*$");Macros.MACRO_DEF_OPEN=/^\\?\{[\w\-]+\}\s*=\s*'(.*)$/;Macros.MACRO_DEF_CLOSE=/^(.*)'$/;Macros.MACRO_DEF=/^\\?\{([\w\-]+)\}\s*=\s*'(.*)'$/;Macros.defs=[];function getValue(name){for(var i in Macros.defs){if(Macros.defs[i].name===name){return Macros.defs[i].value}}return null}Macros.getValue=getValue;function setValue(name,value){for(var i in Macros.defs){if(Macros.defs[i].name===name){Macros.defs[i].value=value;return}}Macros.defs.push({name:name,value:value})}Macros.setValue=setValue;function render(text){text=text.replace(MATCH_MACROS,function(match,name,params){if(match[0]==="\\"){return match.slice(1)}var value=getValue(name);params=params||"";params=params.replace(/\\\}/g,"}");switch(params[0]){case"?":return value===null?params.slice(1):value;case"|":var paramsList=params.slice(1).split("|");value=(value||"").replace(/\\?\$\d+/g,function(match){if(match[0]==="\\"){return match.slice(1)}var param=paramsList[parseInt(match.slice(1))-1];return param===undefined?"":param});return value;case"!":case"=":var pattern=params.slice(1);var skip=!RegExp("^"+pattern+"$").test(value||"");if(params[0]==="!"){skip=!skip}return skip?"\0":"";default:return value||""}});if(text.indexOf("\0")!==-1){var lines=text.split("\n");for(var i=lines.length-1;i>=0;--i){if(lines[i].indexOf("\0")!==-1){lines.splice(i,1)}}text=lines.join("\n")}return text}Macros.render=render;if(typeof exports!=="undefined"){exports.Macros=Rimu.Macros}})(Rimu.Macros||(Rimu.Macros={}));var Macros=Rimu.Macros})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(LineBlocks){var defs=[{match:/^\\?\|([\w\-]+)\|\s*=\s*'(.*)'$/,replacement:"",filter:function(match){if(Rimu.Options.safeMode!==0){return""}Rimu.DelimitedBlocks.setDefinition(match[1],match[2]);return""}},{match:/^(\S)\s*=\s*'([^\|]*)(\|{1,2})(.*)'$/,replacement:"",macros:true,filter:function(match){if(Rimu.Options.safeMode!==0){return""}Rimu.Quotes.setDefinition({quote:match[1],openTag:Rimu.replaceInline(match[2],this),closeTag:Rimu.replaceInline(match[4],this),spans:match[3]==="|"});return""}},{match:/^\\?\/(.+)\/([igm]*)\s*=\s*'(.*)'$/,replacement:"",macros:true,filter:function(match){if(Rimu.Options.safeMode!==0){return""}var pattern=match[1];var flags=match[2];var replacement=match[3];replacement=Rimu.replaceInline(replacement,this);Rimu.Replacements.setDefinition(pattern,flags,replacement);return""}},{match:Rimu.Macros.MACRO_DEF,replacement:"",macros:true,filter:function(match){if(Rimu.Options.safeMode!==0){return""}var name=match[1];var value=match[2];value=Rimu.replaceInline(value,this);Rimu.Macros.setValue(name,value);return""}},{match:Rimu.Macros.MACRO_LINE,replacement:"",verify:function(match){return!Rimu.Macros.MACRO_DEF_OPEN.test(match[0])},filter:function(match,reader){var value=Rimu.Macros.render(match[0]);Array.prototype.splice.apply(reader.lines,[reader.pos+1,0].concat(value.split("\n")));return""}},{match:/^\\?((?:#|=){1,6})\s+(.+?)(?:\s+(?:#|=){1,6})?$/,replacement:"<h$1>$2</h$1>",macros:true,spans:true,filter:function(match){match[1]=match[1].length.toString();return Rimu.replaceMatch(match,this.replacement,this)}},{match:/^\\?\/{2}(.*)$/,replacement:""},{match:/^\\?<image:([^\s\|]+)\|([\s\S]+?)>$/,replacement:'<img src="$1" alt="$2">',macros:true,specials:true},{match:/^\\?<image:([^\s\|]+?)>$/,replacement:'<img src="$1" alt="$1">',macros:true,specials:true},{match:/^\\?<<#([a-zA-Z][\w\-]*)>>$/,replacement:'<div id="$1"></div>',macros:true,specials:true},{name:"attributes",match:/^\\?\.[a-zA-Z#\[+-].*$/,replacement:"",macros:true,filter:function(match){var content=match[0];content=Rimu.replaceInline(content,this);match=/^\\?\.([a-zA-Z][\w\- ]*)?(#[a-zA-Z][\w\-]*\s*)?(?:\s*)?(\[.+\])?(?:\s*)?([+-][ \w+-]+)?$/.exec(content);if(!match){return""}LineBlocks.classAttributes="";LineBlocks.htmlAttributes="";if(match[1]){LineBlocks.classAttributes=Rimu.trim(match[1])}if(match[2]){LineBlocks.htmlAttributes+=' id="'+Rimu.trim(match[2]).slice(1)+'"'}if(match[3]&&Rimu.Options.safeMode===0){LineBlocks.htmlAttributes+=" "+Rimu.trim(match[3].slice(1,match[3].length-1))}LineBlocks.htmlAttributes=Rimu.trim(LineBlocks.htmlAttributes);LineBlocks.blockOptions={};Rimu.DelimitedBlocks.setBlockOptions(LineBlocks.blockOptions,match[4]);return""}}];LineBlocks.classAttributes="";LineBlocks.htmlAttributes="";LineBlocks.blockOptions={};function render(reader,writer){if(reader.eof())console.error("premature eof");for(var i in defs){var def=defs[i];var match=def.match.exec(reader.cursor());if(match){if(match[0][0]==="\\"){reader.cursor(reader.cursor().slice(1));continue}if(def.verify&&!def.verify(match)){continue}var text;if(!def.filter){text=Rimu.replaceMatch(match,def.replacement,def)}else{text=def.filter(match,reader)}text=Rimu.injectHtmlAttributes(text);writer.write(text);reader.next();if(text&&!reader.eof()){writer.write("\n")}return true}}return false}LineBlocks.render=render;function getDefinition(name){for(var i in defs){if(defs[i].name===name){return defs[i]}}return null}LineBlocks.getDefinition=getDefinition;if(typeof exports!=="undefined"){exports.LineBlocks=Rimu.LineBlocks}})(Rimu.LineBlocks||(Rimu.LineBlocks={}));var LineBlocks=Rimu.LineBlocks})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(DelimitedBlocks){var defs=[{openMatch:Rimu.Macros.MACRO_DEF_OPEN,closeMatch:Rimu.Macros.MACRO_DEF_CLOSE,openTag:"",closeTag:"",macros:true,filter:function(text,match,expansionOptions){var name=match[0].match(/^\{([\w\-]+)\}/)[1];text=text.replace(/(' *[\\]*)\\\n/g,"$1\n");text=text.replace(/ +\n/g,"\n");text=Rimu.replaceInline(text,expansionOptions);Rimu.Macros.setValue(name,text);return""}},{name:"comment",openMatch:/^\\?\/\*+$/,closeMatch:/^\*+\/$/,openTag:"",closeTag:"",skip:true,specials:true},{name:"division",openMatch:/^\\?\.{2,}$/,closeMatch:null,openTag:"<div>",closeTag:"</div>",container:true,specials:true},{name:"quote",openMatch:/^\\?"{2,}$/,closeMatch:null,openTag:"<blockquote>",closeTag:"</blockquote>",container:true,specials:true},{name:"code",openMatch:/^\\?\-{2,}$/,closeMatch:null,openTag:"<pre><code>",closeTag:"</code></pre>",macros:false,specials:true},{name:"html",openMatch:/^(<!.*|(?:<\/?(?:html|head|body|iframe|script|style|address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|figcaption|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|img|math|nav|noscript|ol|output|p|pre|section|table|tfoot|td|th|tr|ul|video)(?:[ >].*)?))$/i,closeMatch:/^$/,openTag:"",closeTag:"",macros:true,filter:function(text){return Rimu.Options.safeModeFilter(text)}},{name:"indented",openMatch:/^\\?(\s+.*)$/,closeMatch:/^$/,openTag:"<pre>",closeTag:"</pre>",macros:false,specials:true,filter:function(text){var first_indent=text.search(/\S/);var buffer=text.split("\n");for(var i in buffer){var indent=buffer[i].search(/\S/);if(indent>first_indent)indent=first_indent;buffer[i]=buffer[i].slice(indent)}return buffer.join("\n")}},{name:"paragraph",openMatch:/^(.*)$/,closeMatch:/^$/,openTag:"<p>",closeTag:"</p>",macros:true,spans:true,specials:true}];function render(reader,writer){if(reader.eof())console.error("premature eof");for(var i in defs){var def=defs[i];var match=reader.cursor().match(def.openMatch);if(match){if(match[0][0]==="\\"&&def.name!=="paragraph"){reader.cursor(reader.cursor().slice(1));continue}if(def.verify&&!def.verify(match)){continue}var lines=[];if(match.length>1){lines.push(match[1])}reader.next();var closeMatch;if(def.closeMatch===null){closeMatch=RegExp("^"+Rimu.escapeRegExp(match[0])+"$")}else{closeMatch=def.closeMatch}var content=reader.readTo(closeMatch);if(content!==null){lines=lines.concat(content)}var expansionOptions;expansionOptions={macros:false,spans:false,specials:false,container:false,skip:false};for(var k in expansionOptions)expansionOptions[k]=def[k];for(var k in Rimu.LineBlocks.blockOptions)expansionOptions[k]=Rimu.LineBlocks.blockOptions[k];if(!expansionOptions.skip){writer.write(Rimu.injectHtmlAttributes(def.openTag));var text=lines.join("\n");if(def.filter){text=def.filter(text,match,expansionOptions)}if(expansionOptions.container){text=Rimu.renderSource(text)}else{text=Rimu.replaceInline(text,expansionOptions)}writer.write(text);writer.write(def.closeTag);if((def.openTag||text||def.closeTag)&&!reader.eof()){writer.write("\n")}}Rimu.LineBlocks.blockOptions={};return true}}return false}DelimitedBlocks.render=render;function getDefinition(name){for(var i in defs){if(defs[i].name===name){return defs[i]}}return null}DelimitedBlocks.getDefinition=getDefinition;function setBlockOptions(blockOptions,options){if(options){var opts=options.trim().split(/\s+/);for(var i in opts){var opt=opts[i];if(Rimu.Options.safeMode!==0&&opt==="-specials"){return}if(/^[+-](macros|spans|specials|container|skip)$/.test(opt)){blockOptions[opt.slice(1)]=opt[0]==="+"}}}}DelimitedBlocks.setBlockOptions=setBlockOptions;function setDefinition(name,value){var def=DelimitedBlocks.getDefinition(name);var match=Rimu.trim(value).match(/^(?:(<[a-zA-Z].*>)\|(<[a-zA-Z/].*>))?(?:\s*)?([+-][ \w+-]+)?$/);if(match){if(match[1]){def.openTag=match[1];def.closeTag=match[2]}setBlockOptions(def,match[3])}}DelimitedBlocks.setDefinition=setDefinition;if(typeof exports!=="undefined"){exports.DelimitedBlocks=Rimu.DelimitedBlocks}})(Rimu.DelimitedBlocks||(Rimu.DelimitedBlocks={}));var DelimitedBlocks=Rimu.DelimitedBlocks})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(Lists){var defs=[{match:/^\\?\s*(-|\*{1,4})\s+(.*)$/,listOpenTag:"<ul>",listCloseTag:"</ul>",itemOpenTag:"<li>",itemCloseTag:"</li>"},{match:/^\\?\s*(?:\d*)(\.{1,4})\s+(.*)$/,listOpenTag:"<ol>",listCloseTag:"</ol>",itemOpenTag:"<li>",itemCloseTag:"</li>"},{match:/^\\?\s*(.*[^:])(:{2,4})(|\s+.*)$/,listOpenTag:"<dl>",listCloseTag:"</dl>",itemOpenTag:"<dd>",itemCloseTag:"</dd>",termOpenTag:"<dt>",termCloseTag:"</dt>"}];var ids;function render(reader,writer){if(reader.eof())console.error("premature eof");var startItem;if(!(startItem=matchItem(reader))){return false}ids=[];renderList(startItem,reader,writer);return true}Lists.render=render;function renderList(startItem,reader,writer){ids.push(startItem.id);writer.write(Rimu.injectHtmlAttributes(startItem.def.listOpenTag));var nextItem;while(true){nextItem=renderListItem(startItem,reader,writer);if(!nextItem||nextItem.id!==startItem.id){writer.write(startItem.def.listCloseTag);ids.pop();return nextItem}startItem=nextItem}}function renderListItem(startItem,reader,writer){var def=startItem.def;var match=startItem.match;var text;if(match.length===4){writer.write(def.termOpenTag);text=Rimu.replaceInline(match[1],{macros:true,spans:true});writer.write(text);writer.write(def.termCloseTag)}writer.write(def.itemOpenTag);var lines=new Rimu.Writer;lines.write(match[match.length-1]);lines.write("\n");reader.next();var nextItem;nextItem=readToNext(reader,lines);text=lines.toString();text=Rimu.replaceInline(text,{macros:true,spans:true});writer.write(text);while(true){if(!nextItem){writer.write(def.itemCloseTag);return null}else if(nextItem.isListItem){if(ids.indexOf(nextItem.id)!==-1){writer.write(def.itemCloseTag);return nextItem}else{nextItem=renderList(nextItem,reader,writer);writer.write(def.itemCloseTag);return nextItem}}else if(nextItem.isDelimited||nextItem.isIndented){var savedIds=ids;ids=[];Rimu.DelimitedBlocks.render(reader,writer);ids=savedIds;reader.skipBlankLines();if(reader.eof()){writer.write(def.itemCloseTag);return null}else{nextItem=matchItem(reader)}}}}function readToNext(reader,writer){var next;while(true){if(reader.eof())return null;if(reader.cursor()===""){reader.skipBlankLines();if(reader.eof())return null;return matchItem(reader,{delimited:true,indented:true})}next=matchItem(reader,{delimited:true});if(next){return next}writer.write(reader.cursor());writer.write("\n");reader.next()}}function matchItem(reader,options){if(typeof options==="undefined"){options={}}var attrRe=Rimu.LineBlocks.getDefinition("attributes").match;if(attrRe.test(reader.cursor())){Rimu.LineBlocks.render(reader,new Rimu.Writer)}var line=reader.cursor();var item={};var def;for(var i in defs){var match=defs[i].match.exec(line);if(match){if(match[0][0]==="\\"){reader.cursor(reader.cursor().slice(1));return null}item.match=match;item.def=defs[i];item.id=match[match.length-2];item.isListItem=true;return item}}if(options.delimited){for(var id in{quote:0,code:0,division:0}){def=Rimu.DelimitedBlocks.getDefinition(id);if(def.openMatch.test(line)){item.isDelimited=true;return item}}}if(options.indented){def=Rimu.DelimitedBlocks.getDefinition("indented");if(def.openMatch.test(line)){item.isIndented=true;return item}}return null}if(typeof exports!=="undefined"){exports.Lists=Lists}})(Rimu.Lists||(Rimu.Lists={}));var Lists=Rimu.Lists})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(Spans){function render(source){var fragments=[{text:source,done:false}];fragQuotes(fragments);fragReplacements(fragments);fragSpecials(fragments);return defrag(fragments)}Spans.render=render;function defrag(fragments){var result=[];for(var i in fragments){result.push(fragments[i].text)}return result.join("")}function fragQuotes(fragments){var findRe=Rimu.Quotes.findRe;var fragmentIndex=0;var fragment=fragments[fragmentIndex];var nextFragment;var match;findRe.lastIndex=0;while(true){if(fragment.done){nextFragment=true}else{match=findRe.exec(fragment.text);nextFragment=!match}if(nextFragment){fragmentIndex++;if(fragmentIndex>=fragments.length){break}fragment=fragments[fragmentIndex];if(match){findRe.lastIndex=0}continue}if(match[0][0]==="\\"){continue}var def=Rimu.Quotes.getDefinition(match[1]);if(def.verify&&!def.verify(match,findRe)){findRe.lastIndex=match.index+1;continue}var before=match.input.slice(0,match.index);var quoted=match[2];var after=match.input.slice(findRe.lastIndex);fragments.splice(fragmentIndex,1,{text:before,done:false},{text:def.openTag,done:true},{text:quoted,done:false},{text:def.closeTag,done:true},{text:after,done:false});fragmentIndex+=2;fragment=fragments[fragmentIndex];if(!def.spans){fragment.text=Rimu.Quotes.unescape(fragment.text);fragment.text=Rimu.replaceSpecialChars(fragment.text);fragment.done=true;fragmentIndex+=2;fragment=fragments[fragmentIndex]}findRe.lastIndex=0}for(var i in fragments){fragment=fragments[i];if(!fragment.done){fragment.text=Rimu.Quotes.unescape(fragment.text)}}}function fragReplacements(fragments){for(var i in Rimu.Replacements.defs){fragReplacement(fragments,Rimu.Replacements.defs[i])}}function fragReplacement(fragments,def){var findRe=def.match;var fragmentIndex=0;var fragment=fragments[fragmentIndex];var nextFragment;var match;findRe.lastIndex=0;while(true){if(fragment.done){nextFragment=true}else{match=findRe.exec(fragment.text);nextFragment=!match}if(nextFragment){fragmentIndex++;if(fragmentIndex>=fragments.length){break}fragment=fragments[fragmentIndex];if(match){findRe.lastIndex=0}continue}var before=match.input.slice(0,match.index);var after=match.input.slice(findRe.lastIndex);fragments.splice(fragmentIndex,1,{text:before,done:false},{text:"",done:true},{text:after,done:false});fragmentIndex++;fragment=fragments[fragmentIndex];if(match[0][0]==="\\"){fragment.text=match.input.slice(match.index+1,findRe.lastIndex);fragment.text=Rimu.replaceSpecialChars(fragment.text)}else{if(!def.filter){fragment.text=Rimu.replaceMatch(match,def.replacement,{specials:true})}else{fragment.text=def.filter(match)}}fragmentIndex++;fragment=fragments[fragmentIndex];findRe.lastIndex=0}}function fragSpecials(fragments){var fragment;for(var i in fragments){fragment=fragments[i];if(!fragment.done){fragment.text=Rimu.replaceSpecialChars(fragment.text)}}}if(typeof exports!=="undefined"){exports.Spans=Rimu.Spans}})(Rimu.Spans||(Rimu.Spans={}));var Spans=Rimu.Spans})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(Quotes){Quotes.defs=[{quote:"_",openTag:"<em>",closeTag:"</em>",spans:true},{quote:"*",openTag:"<strong>",closeTag:"</strong>",spans:true},{quote:"`",openTag:"<code>",closeTag:"</code>",spans:false}];Quotes.findRe;var unescapeRe;initialize();function initialize(){var s=[];for(var i in Quotes.defs){s.push(Rimu.escapeRegExp(Quotes.defs[i].quote))}Quotes.findRe=RegExp("\\\\?("+s.join("|")+")([^\\s\\\\]|\\S[\\s\\S]*?[^\\s\\\\])\\1","g");unescapeRe=RegExp("\\\\("+s.join("|")+")","g")}function getDefinition(quote){for(var i in Quotes.defs){if(Quotes.defs[i].quote===quote)return Quotes.defs[i]}return null}Quotes.getDefinition=getDefinition;function unescape(s){return s.replace(unescapeRe,"$1")}Quotes.unescape=unescape;function setDefinition(def){for(var i in Quotes.defs){if(Quotes.defs[i].quote===def.quote){Quotes.defs[i].openTag=def.openTag;Quotes.defs[i].closeTag=def.closeTag;Quotes.defs[i].spans=def.spans;return}}Quotes.defs.unshift(def);initialize()}Quotes.setDefinition=setDefinition;if(typeof exports!=="undefined"){exports.Quotes=Rimu.Quotes}})(Rimu.Quotes||(Rimu.Quotes={}));var Quotes=Rimu.Quotes})(Rimu||(Rimu={}));var Rimu;(function(Rimu){(function(Replacements){Replacements.defs=[{match:/\\?(&[\w#][\w]+;)/g,replacement:"",filter:function(match){return match[1]}},{match:/[\\ ]\\(\n|$)/g,replacement:"<br>$1"},{match:/[\\ ]\+(\n|$)/g,replacement:"<br>$1"},{match:/\\?<<#([a-zA-Z][\w\-]*)>>/g,replacement:'<span id="$1"></span>'},{match:/\\?<image:([^\s\|]+)\|([\s\S]+?)>/g,replacement:'<img src="$1" alt="$2">'},{match:/\\?<image:([^\s\|]+?)>/g,replacement:'<img src="$1" alt="$1">'},{match:/\\?<(\S+@[\w\.\-]+)\|([\s\S]+?)>/g,replacement:'<a href="mailto:$1">$2</a>'},{match:/\\?<(\S+@[\w\.\-]+)>/g,replacement:'<a href="mailto:$1">$1</a>'},{match:/\\?(<[!\/]?[a-zA-Z\-]+(:?\s+[^<>&]+)?>)/g,replacement:"",filter:function(match){return Rimu.Options.safeModeFilter(match[1])}},{match:/\\?<(\S+?)\|([\s\S]+?)>/g,replacement:'<a href="$1">$2</a>'},{match:/\\?<(\S+?)>/g,replacement:'<a href="$1">$1</a>'}];function setDefinition(regexp,flags,replacement){if(!/g/.test(flags)){flags+="g"}for(var i in Replacements.defs){if(Replacements.defs[i].match.source===regexp){Replacements.defs[i].match=new RegExp(regexp,flags);Replacements.defs[i].replacement=replacement;return}}Replacements.defs.unshift({match:new RegExp(regexp,flags),replacement:replacement})}Replacements.setDefinition=setDefinition;if(typeof exports!=="undefined"){exports.Replacements=Rimu.Replacements}})(Rimu.Replacements||(Rimu.Replacements={}));var Replacements=Rimu.Replacements})(Rimu||(Rimu={}));