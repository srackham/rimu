!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Rimu=t():e.Rimu=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e,t){if(void 0===t&&(t={}),"string"!=typeof e)throw new TypeError("render(): source argument is not a string");if(void 0!==t&&"object"!=typeof t)throw new TypeError("render(): options argument is not an object");return a.updateOptions(t),i.render(e)}var i=n(4),a=n(2);t.render=r,i.reset()},function(e,t,n){function r(e){return e.replace(/^\s+/g,"")}function i(e){return e.replace(/\s+$/g,"")}function a(e){return e.replace(/^\s+|\s+$/g,"")}function o(e){return e.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}function s(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}function c(e,t,n){return void 0===n&&(n={}),t.replace(/(\${1,2})(\d)/g,function(){"$$"===arguments[1]?n.spans=!0:n.specials=!0;var t=Number(arguments[2]),r=e[t];return p(r,n)})}function l(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function u(e,t){for(var n in t)e[n]=t[n]}function p(e,t){return t.macros&&(e=m.render(e),e=null===e?"":e),t.spans?e=h.render(e):t.specials&&(e=s(e)),e}function f(e){if(!e)return e;if(d.htmlClasses&&(/class="\S.*"/.test(e)?e=e.replace(/class="(\S.*?)"/,'class="'+d.htmlClasses+' $1"'):d.htmlAttributes=a('class="'+d.htmlClasses+'" '+d.htmlAttributes)),d.htmlAttributes){var t=e.match(/^<([a-zA-Z]+|h[1-6])(?=[ >])/);if(t){var n=e.slice(0,t[0].length),r=e.slice(t[0].length);e=n+" "+d.htmlAttributes+r}}return d.htmlClasses="",d.htmlAttributes="",e}var m=n(3),h=n(11),d=n(6);t.trimLeft=r,t.trimRight=i,t.trim=a,t.escapeRegExp=o,t.replaceSpecialChars=s,t.replaceMatch=c,t.copy=l,t.merge=u,t.replaceInline=p,t.injectHtmlAttributes=f},function(e,t,n){function r(){t.safeMode=0,t.htmlReplacement="<mark>replaced HTML</mark>",f=void 0}function i(){return 0!==t.safeMode}function a(e){var n=Number(e);!isNaN(n)&&n>=0&&3>=n&&(t.safeMode=n)}function o(e){t.htmlReplacement=e}function s(e){(e===!0||"true"===e)&&h.reset()}function c(e){"reset"in e&&s(e.reset),"safeMode"in e&&a(e.safeMode),"htmlReplacement"in e&&o(e.htmlReplacement),"callback"in e&&(f=e.callback)}function l(e,t){var n={};n[e]=t,c(n)}function u(e){switch(t.safeMode){case 0:return e;case 1:return"";case 2:return t.htmlReplacement;case 3:return m.replaceSpecialChars(e)}}function p(e){f&&f({type:"error",text:e})}var f,m=n(1),h=n(4);t.setDefaults=r,t.isSafe=i,t.updateOptions=c,t.setOption=l,t.safeModeFilter=u,t.errorCallback=p},function(e,t,n){function r(){t.defs=[]}function i(e){for(var n=0;n<t.defs.length;n++){var r=t.defs[n];if(r.name===e)return r.value}return null}function a(e,n){var r=!1;"?"===e.slice(-1)&&(e=e.slice(0,-1),r=!0);for(var i=0;i<t.defs.length;i++){var a=t.defs[i];if(a.name===e)return void(r||(a.value=n))}t.defs.push({name:e,value:n})}function o(e,t){if(void 0===t&&(t=!0),e=e.replace(l,function(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];if("\\"===n[0])return n.slice(1);var o=r[0],c=r[1]||"";if("?"===c[0])return t&&s.errorCallback("existential macro invocations are deprecated: "+n),n;var l=i(o);if(null===l)return t&&s.errorCallback("undefined macro: "+n+": "+e),n;switch(c=c.replace(/\\\}/g,"}"),c[0]){case"|":var u=c.slice(1).split("|");return l=(l||"").replace(/\\?\$\d+/g,function(e){if("\\"===e[0])return e.slice(1);var t=u[Number(e.slice(1))-1];return void 0===t?"":t});case"!":case"=":var p=c.slice(1),f=!RegExp("^"+p+"$").test(l||"");return"!"===c[0]&&(f=!f),f?"\x00":"";default:return l||""}}),-1!==e.indexOf("\x00")){for(var n=e.split("\n"),r=n.length-1;r>=0;--r)-1!==n[r].indexOf("\x00")&&n.splice(r,1);e=n.join("\n")}return e}var s=n(2),c=/\{([\w\-]+)([!=|?](?:|[\s\S]*?[^\\]))?\}/,l=RegExp("\\\\?"+c.source,"g");t.MACRO_LINE=RegExp("^"+c.source+".*$"),t.MACRO_DEF_OPEN=/^\\?\{[\w\-]+\??\}\s*=\s*'(.*)$/,t.MACRO_DEF_CLOSE=/^(.*)'$/,t.MACRO_DEF=/^\\?\{([\w\-]+\??)\}\s*=\s*'(.*)'$/,t.defs=[],t.reset=r,t.getValue=i,t.setValue=a,t.render=o},function(e,t,n){function r(e){for(var t=new a.Reader(e),n=new a.Writer;!t.eof()&&(t.skipBlankLines(),!t.eof());)if(!o.render(t,n)&&!c.render(t,n)&&!s.render(t,n))throw"no matching delimited block found";return n.toString()}function i(){u.setDefaults(),s.reset(),l.reset(),p.reset(),f.reset()}var a=n(9),o=n(6),s=n(5),c=n(10),l=n(3),u=n(2),p=n(7),f=n(8);t.render=r,t.reset=i},function(e,t,n){function r(){u=g.map(function(e){return f.copy(e)})}function i(e,t){if(e.eof())throw"premature eof";for(var n=0;n<u.length;n++){var r=u[n],i=e.cursor().match(r.openMatch);if(i){if("\\"===i[0][0]&&"paragraph"!==r.name){e.cursor(e.cursor().slice(1));continue}var a=r.delimiterFilter?r.delimiterFilter(i):"",o=[];a&&o.push(a),e.next();var s=e.readTo(r.closeMatch);null===s&&m.errorCallback("unterminated delimited block: "+i[0]),s&&(o=o.concat(s));var c={macros:!1,spans:!1,specials:!1,container:!1,skip:!1};if(f.merge(c,r.expansionOptions),f.merge(c,d.blockOptions),!c.skip){var l=o.join("\n");r.contentfilter&&(l=r.contentfilter(l,i,c)),t.write(f.injectHtmlAttributes(r.openTag)),c.container?(delete d.blockOptions.container,l=p.render(l)):l=f.replaceInline(l,c),t.write(l),t.write(r.closeTag),(r.openTag||l||r.closeTag)&&!e.eof()&&t.write("\n")}return d.blockOptions={},!0}}return!1}function a(e){return u.filter(function(t){return t.name===e})[0]}function o(e,t){if(t)for(var n=t.trim().split(/\s+/),r=0;r<n.length;r++){var i=n[r];m.isSafe()&&"-specials"===i?m.errorCallback("-specials block option not valid in safeMode"):/^[+-](macros|spans|specials|container|skip)$/.test(i)?e[i.slice(1)]="+"===i[0]:m.errorCallback("illegal block option: "+i)}}function s(e,t){var n=a(e);if(!n)return void m.errorCallback("illegal delimited block name: "+e+": |"+e+"|='"+t+"'");var r=f.trim(t).match(/^(?:(<[a-zA-Z].*>)\|(<[a-zA-Z\/].*>))?(?:\s*)?([+-][ \w+-]+)?$/);r&&(r[1]&&(n.openTag=r[1],n.closeTag=r[2]),o(n.expansionOptions,r[3]))}function c(e){return e[1]}function l(e){if(e[2]){var t;(t=f.trim(e[2]))&&(d.htmlClasses=t)}return this.closeMatch=RegExp("^"+f.escapeRegExp(e[1])+"$"),""}var u,p=n(4),f=n(1),m=n(2),h=n(3),d=n(6),g=[{openMatch:h.MACRO_DEF_OPEN,closeMatch:h.MACRO_DEF_CLOSE,openTag:"",closeTag:"",expansionOptions:{macros:!0},delimiterFilter:c,contentfilter:function(e,t,n){var r=t[0].match(/^\{([\w\-]+\??)\}/)[1];return e=e.replace(/' *\\\n/g,"'\n"),e=e.replace(/(' *[\\]+)\\\n/g,"$1\n"),e=f.replaceInline(e,n),h.setValue(r,e),""}},{name:"comment",openMatch:/^\\?\/\*+$/,closeMatch:/^\*+\/$/,openTag:"",closeTag:"",expansionOptions:{skip:!0,specials:!0}},{name:"division",openMatch:/^\\?(\.{2,})([\w\s-]*)$/,openTag:"<div>",closeTag:"</div>",expansionOptions:{container:!0,specials:!0},delimiterFilter:l},{name:"quote",openMatch:/^\\?("{2,})([\w\s-]*)$/,openTag:"<blockquote>",closeTag:"</blockquote>",expansionOptions:{container:!0,specials:!0},delimiterFilter:l},{name:"code",openMatch:/^\\?(\-{2,}|`{2,})([\w\s-]*)$/,openTag:"<pre><code>",closeTag:"</code></pre>",expansionOptions:{macros:!1,specials:!0},delimiterFilter:l},{name:"html",openMatch:/^(<!.*|(?:<\/?(?:html|head|body|iframe|script|style|address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|figcaption|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|img|math|nav|noscript|ol|output|p|pre|section|table|textarea|tfoot|td|th|tr|ul|video)(?:[ >].*)?))$/i,closeMatch:/^$/,openTag:"",closeTag:"",expansionOptions:{macros:!0},delimiterFilter:c,contentfilter:m.safeModeFilter},{name:"indented",openMatch:/^\\?(\s+.*)$/,closeMatch:/^$/,openTag:"<pre><code>",closeTag:"</code></pre>",expansionOptions:{macros:!1,specials:!0},delimiterFilter:c,contentfilter:function(e){var t=e.search(/\S/),n=e.split("\n");for(var r in n){var i=n[r].search(/\S/);i>t&&(i=t),n[r]=n[r].slice(i)}return n.join("\n")}},{name:"quote-paragraph",openMatch:/^\\?(>.*)$/,closeMatch:/^$/,openTag:"<blockquote><p>",closeTag:"</p></blockquote>",expansionOptions:{macros:!0,spans:!0,specials:!0},delimiterFilter:c,contentfilter:function(e){var t=e.split("\n");for(var n in t)t[n]=t[n].replace(/^>/,""),t[n]=t[n].replace(/^\\>/,">");return t.join("\n")}},{name:"paragraph",openMatch:/^(.*)$/,closeMatch:/^$/,openTag:"<p>",closeTag:"</p>",expansionOptions:{macros:!0,spans:!0,specials:!0},delimiterFilter:c}];t.reset=r,t.render=i,t.getDefinition=a,t.setBlockOptions=o,t.setDefinition=s},function(e,t,n){function r(e,t){if(e.eof())throw"premature eof";for(var n=0;n<p.length;n++){var r=p[n],i=r.match.exec(e.cursor());if(i){if("\\"===i[0][0]){e.cursor(e.cursor().slice(1));continue}if(r.verify&&!r.verify(i))continue;var o=void 0;return o=r.filter?r.filter(i,e):r.replacement?a.replaceMatch(i,r.replacement,{macros:!0}):"",o?(o=a.injectHtmlAttributes(o),t.write(o),e.next(),e.eof()||t.write("\n")):e.next(),!0}}return!1}function i(e){return p.filter(function(t){return t.name===e})[0]}var a=n(1),o=n(2),s=n(5),c=n(7),l=n(8),u=n(3),p=[{match:u.MACRO_LINE,verify:function(e){if(u.MACRO_DEF_OPEN.test(e[0]))return!1;var t=u.render(e[0],!1);return t===e[0]?!1:!0},filter:function(e,t){var n=u.render(e[0],!1),r=[t.pos+1,0].concat(n.split("\n"));return Array.prototype.splice.apply(t.lines,r),""}},{match:/^\\?\|([\w\-]+)\|\s*=\s*'(.*)'$/,filter:function(e){return o.isSafe()?"":(s.setDefinition(e[1],e[2]),"")}},{match:/^(\S{1,2})\s*=\s*'([^\|]*)(\|{1,2})(.*)'$/,filter:function(e){return o.isSafe()?"":(c.setDefinition({quote:e[1],openTag:a.replaceInline(e[2],{macros:!0}),closeTag:a.replaceInline(e[4],{macros:!0}),spans:"|"===e[3]}),"")}},{match:/^\\?\/(.+)\/([igm]*)\s*=\s*'(.*)'$/,filter:function(e){if(o.isSafe())return"";var t=e[1],n=e[2],r=e[3];return r=a.replaceInline(r,{macros:!0}),l.setDefinition(t,n,r),""}},{match:u.MACRO_DEF,filter:function(e){if(o.isSafe())return"";var t=e[1],n=e[2];return n=a.replaceInline(n,{macros:!0}),u.setValue(t,n),""}},{match:/^\\?((?:#|=){1,6})\s+(.+?)(?:\s+(?:#|=){1,6})?$/,replacement:"<h$1>$$2</h$1>",filter:function(e){return e[1]=e[1].length.toString(),a.replaceMatch(e,this.replacement,{macros:!0})}},{match:/^\\?\/{2}(.*)$/},{match:/^\\?<image:([^\s\|]+)\|([\s\S]+?)>$/,replacement:'<img src="$1" alt="$2">'},{match:/^\\?<image:([^\s\|]+?)>$/,replacement:'<img src="$1" alt="$1">'},{match:/^\\?<<#([a-zA-Z][\w\-]*)>>$/,replacement:'<div id="$1"></div>'},{name:"attributes",match:/^\\?\.[a-zA-Z#\[+-].*$/,verify:function(e){var n=e[0];return n=a.replaceInline(n,{macros:!0}),(e=/^\\?\.((?:\s*[a-zA-Z][\w\-]*)+)*(?:\s*)?(#[a-zA-Z][\w\-]*\s*)?(?:\s*)?(\[.+\])?(?:\s*)?([+-][ \w+-]+)?$/.exec(n))?(e[1]&&(t.htmlClasses+=" "+a.trim(e[1]),t.htmlClasses=a.trim(t.htmlClasses)),e[2]&&(t.htmlAttributes+=' id="'+a.trim(e[2]).slice(1)+'"'),e[3]&&!o.isSafe()&&(t.htmlAttributes+=" "+a.trim(e[3].slice(1,e[3].length-1))),t.htmlAttributes=a.trim(t.htmlAttributes),s.setBlockOptions(t.blockOptions,e[4]),!0):!1}},{match:/^\\?\.(\w+)\s*=\s*'(.*)'$/,filter:function(e){if(/^(safeMode|htmlReplacement|reset)$/.test(e[1])){if(!o.isSafe()){var t=a.replaceInline(e[2],{macros:!0});o.setOption(e[1],t)}}else o.errorCallback("illegal API option: "+e[1]+": "+e[0]);return""}}];t.htmlClasses="",t.htmlAttributes="",t.blockOptions={},t.render=r,t.getDefinition=i},function(e,t,n){function r(){c=p.map(function(e){return u.copy(e)}),i()}function i(){var e=c.map(function(e){return u.escapeRegExp(e.quote)});t.quotesRe=RegExp("\\\\?("+e.join("|")+")([^\\s\\\\]|\\S[\\s\\S]*?[^\\s\\\\])\\1","g"),l=RegExp("\\\\("+e.join("|")+")","g")}function a(e){return c.filter(function(t){return t.quote===e})[0]}function o(e){return e.replace(l,"$1")}function s(e){for(var t=0;t<c.length;t++){var n=c[t];if(n.quote===e.quote)return n.openTag=e.openTag,n.closeTag=e.closeTag,void(n.spans=e.spans)}2===e.quote.length?c.unshift(e):c.push(e),i()}var c,l,u=n(1),p=[{quote:"**",openTag:"<strong>",closeTag:"</strong>",spans:!0},{quote:"*",openTag:"<em>",closeTag:"</em>",spans:!0},{quote:"__",openTag:"<strong>",closeTag:"</strong>",spans:!0},{quote:"_",openTag:"<em>",closeTag:"</em>",spans:!0},{quote:"``",openTag:"<code>",closeTag:"</code>",spans:!1},{quote:"`",openTag:"<code>",closeTag:"</code>",spans:!1},{quote:"~~",openTag:"<del>",closeTag:"</del>",spans:!0}];t.reset=r,t.initializeRegExps=i,t.getDefinition=a,t.unescape=o,t.setDefinition=s},function(e,t,n){function r(){t.defs=s.map(function(e){return o.copy(e)})}function i(e,n,r){/g/.test(n)||(n+="g");for(var i=0;i<t.defs.length;i++){var a=t.defs[i];if(a.match.source===e)return a.match=new RegExp(e,n),void(a.replacement=r)}t.defs.unshift({match:new RegExp(e,n),replacement:r})}var a=n(2),o=n(1),s=[{match:/\\?<<#([a-zA-Z][\w\-]*)>>/g,replacement:'<span id="$1"></span>'},{match:/\\?<image:([^\s\|]+)\|([\s\S]*?)>/g,replacement:'<img src="$1" alt="$2">'},{match:/\\?<image:([^\s\|]+?)>/g,replacement:'<img src="$1" alt="$1">'},{match:/\\?!\[([\s\S]*?)\]\s*\((\S+?)\)/g,replacement:'<img src="$2" alt="$1">'},{match:/\\?<(\S+@[\w\.\-]+)\|([\s\S]+?)>/g,replacement:'<a href="mailto:$1">$$2</a>'},{match:/\\?<(\S+@[\w\.\-]+)>/g,replacement:'<a href="mailto:$1">$1</a>'},{match:/\\?\[([\s\S]*?)\]\s*\((.+?)\)/g,replacement:'<a href="$2">$$1</a>'},{match:/\\?(<[!\/]?[a-zA-Z\-]+(:?\s+[^<>&]+)?>)/g,replacement:"",filter:function(e){return a.safeModeFilter(e[1])}},{match:/\\?<([^|]+?)>/g,replacement:'<a href="$1">$1</a>'},{match:/\\?<(.+?)\|([\s\S]*?)>/g,replacement:'<a href="$1">$$2</a>'},{match:/\\?((?:http|https):\/\/[^\s"']*[A-Za-z0-9\/#])/g,replacement:'<a href="$1">$1</a>'},{match:/\\?(&[\w#][\w]+;)/g,replacement:"",filter:function(e){return e[1]}},{match:/[\\ ]\\(\n|$)/g,replacement:"<br>$1"},{match:/(\S\\)(?=`)/g,replacement:"$1"},{match:/([a-zA-Z0-9]_)(?=[a-zA-Z0-9])/g,replacement:"$1"}];t.reset=r,t.setDefinition=i},function(e,t){var n=function(){function e(e){this.lines=e.split(/\r\n|\r|\n/g),this.pos=0}return e.prototype.cursor=function(e){return void 0===e&&(e=null),this.eof()?null:(null!==e&&(this.lines[this.pos]=e),this.lines[this.pos])},e.prototype.eof=function(){return this.pos>=this.lines.length},e.prototype.next=function(){return this.eof()?null:(this.pos++,this.eof()?null:this.lines[this.pos])},e.prototype.readTo=function(e){for(var t,n=[];!this.eof();){if(t=this.cursor().match(e)){void 0!==t[1]&&n.push(t[1]),this.next();break}n.push(this.cursor()),this.next()}return t||"/^$/"===e.toString()&&this.eof()?n:null},e.prototype.skipBlankLines=function(){for(;""===this.cursor();)this.next()},e}();t.Reader=n;var r=function(){function e(){this.buffer=[]}return e.prototype.write=function(e){this.buffer.push(e)},e.prototype.toString=function(){return this.buffer.join("")},e}();t.Writer=r},function(e,t,n){function r(e,t){if(e.eof())throw"premature eof";var n;return(n=s(e))?(c=[],i(n,e,t),!0):!1}function i(e,t,n){c.push(e.id),n.write(l.injectHtmlAttributes(e.def.listOpenTag));for(var r;;){if(r=a(e,t,n),!r||r.id!==e.id)return n.write(e.def.listCloseTag),c.pop(),r;e=r}}function a(e,t,n){var r,a=e.def,f=e.match;4===f.length&&(n.write(a.termOpenTag),r=l.replaceInline(f[1],{macros:!0,spans:!0}),n.write(r),n.write(a.termCloseTag)),n.write(a.itemOpenTag);var m=new u.Writer;m.write(f[f.length-1]),m.write("\n"),t.next();var h;for(h=o(t,m),r=m.toString(),r=l.replaceInline(r,{macros:!0,spans:!0}),n.write(r);;){if(!h)return n.write(a.itemCloseTag),null;if(h.isListItem)return-1!==c.indexOf(h.id)?(n.write(a.itemCloseTag),h):(h=i(h,t,n),n.write(a.itemCloseTag),h);if(h.isDelimited||h.isIndented){var d=c;if(c=[],p.render(t,n),c=d,t.skipBlankLines(),t.eof())return n.write(a.itemCloseTag),null;h=s(t)}}}function o(e,t){for(var n;;){if(e.eof())return null;if(""===e.cursor())return e.next(),""===e.cursor()?null:(e.skipBlankLines(),e.eof()?null:s(e,{indented:!0}));if(n=s(e,{delimited:!0}))return n;t.write(e.cursor()),t.write("\n"),e.next()}}function s(e,t){void 0===t&&(t={});for(var n=e.cursor(),r={},i=0;i<f.length;i++){var a=f[i],o=a.match.exec(n);if(o)return"\\"===o[0][0]?(e.cursor(e.cursor().slice(1)),null):(r.match=o,r.def=a,r.id=o[o.length-2],r.isListItem=!0,r)}if(t.delimited)for(var a,s=0,c=["quote","code","division"];s<c.length;s++){var l=c[s];if(a=p.getDefinition(l),a.openMatch.test(n))return r.isDelimited=!0,r}if(t.indented){var a=p.getDefinition("indented");if(a.openMatch.test(n))return r.isIndented=!0,r}return null}var c,l=n(1),u=n(9),p=n(5),f=[{match:/^\\?\s*(-|\+|\*{1,4})\s+(.*)$/,listOpenTag:"<ul>",listCloseTag:"</ul>",itemOpenTag:"<li>",itemCloseTag:"</li>"},{match:/^\\?\s*(?:\d*)(\.{1,4})\s+(.*)$/,listOpenTag:"<ol>",listCloseTag:"</ol>",itemOpenTag:"<li>",itemCloseTag:"</li>"},{match:/^\\?\s*(.*[^:])(:{2,4})(|\s+.*)$/,listOpenTag:"<dl>",listCloseTag:"</dl>",itemOpenTag:"<dd>",itemCloseTag:"</dd>",termOpenTag:"<dt>",termCloseTag:"</dt>"}];t.render=r},function(e,t,n){function r(e){var t;t=s(e);var n=[{text:t,done:!1}];return n=a(n),p(n),t=i(n),c(t)}function i(e){return e.reduce(function(e,t){return e+t.text},"")}function a(e){var t;return t=[],e.forEach(function(e){t.push.apply(t,o(e))}),t.filter(function(e){return!e.done}).forEach(function(e){return e.text=m.unescape(e.text)}),t}function o(e){if(e.done)return[e];var t,n=m.quotesRe;for(n.lastIndex=0;;){if(t=n.exec(e.text),!t)return[e];if("\\"!==t[0][0])break;n.lastIndex=t.index+t[1].length+1}for(var r=[],i=m.getDefinition(t[1]);e.text[n.lastIndex]===t[1][0];)t[2]+=t[1][0],n.lastIndex+=1;var a=t.input.slice(0,t.index),s=t[2],c=t.input.slice(n.lastIndex);return r.push({text:a,done:!1}),r.push({text:i.openTag,done:!0}),i.spans?r.push.apply(r,o({text:s,done:!1})):(s=f.replaceSpecialChars(s),s=s.replace(/\u0000/g,""),r.push({text:s,done:!0})),r.push({text:i.closeTag,done:!0}),r.push.apply(r,o({text:c,done:!1})),r}function s(e){d=[];var t=l([{text:e,done:!1}]);return t.reduce(function(e,t){return t.done?(d.push(t),e+"\x00"):e+t.text},"")}function c(e){return e.replace(/\u0000|\u0001/g,function(e){var t=d.shift();return"\x00"===e?t.text:f.replaceSpecialChars(t.verbatim)})}function l(e){var t;return h.defs.forEach(function(n){t=[],e.forEach(function(e){t.push.apply(t,u(e,n))}),e=t}),t}function u(e,t){if(e.done)return[e];var n,r=t.match;if(r.lastIndex=0,n=r.exec(e.text),!n)return[e];var i=[],a=n.input.slice(0,n.index),o=n.input.slice(r.lastIndex);i.push({text:a,done:!1});var s;return s="\\"===n[0][0]?f.replaceSpecialChars(n[0].slice(1)):t.filter?t.filter(n):f.replaceMatch(n,t.replacement),i.push({text:s,done:!0,verbatim:n[0]}),i.push.apply(i,u({text:o,done:!1},t)),i}function p(e){e.filter(function(e){return!e.done}).forEach(function(e){return e.text=f.replaceSpecialChars(e.text)})}var f=n(1),m=n(7),h=n(8);t.render=r;var d}])});